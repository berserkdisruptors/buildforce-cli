version: "0.0.36"
# Plan Template for /buildforce.build Agent Execution
# This template is optimized for AI agent consumption during /buildforce.build commands
# It provides checkbox-based progress tracking, deviation logging, and spec traceability

id: rename-create-spec-to-session-20251126000000-plan
name: "Implementation Plan for Rename create-spec-files scripts to create-session-files"
spec_id: "rename-create-spec-to-session-20251126000000"
type: implementation-plan
status: completed
created: "2025-11-26"
last_updated: "2025-11-26"

# ARCHITECTURE OVERVIEW
# Describe the high-level implementation approach and key technical decisions.

approach: |
  This is a straightforward file rename operation with atomic reference updates. The approach is
  to rename both bash and PowerShell scripts simultaneously, then update all references in a single
  commit. Use git mv for proper rename tracking. The implementation follows a three-phase strategy:
  Phase 1 renames the scripts, Phase 2 updates template and documentation references, Phase 3 validates
  functionality. This ensures no broken references exist at any point.

technology_stack:
  - Git mv for file renaming (preserves history)
  - Bash and PowerShell scripting (no changes to script logic)
  - YAML editing for template and context file updates

decisions:
  - decision: "Use git mv instead of manual rename + git add"
    rationale: "Git mv preserves file history and makes the rename operation explicit in version control. This helps future developers understand that files were renamed rather than deleted and recreated."

  - decision: "Update all references atomically in single commit"
    rationale: "Prevents inconsistent state where some references point to old names and others to new names. All changes must be made together to maintain system integrity."

  - decision: "Leave historical session files unchanged"
    rationale: "The 18+ session files in .buildforce/sessions/ are read-only archives documenting past work. Updating them provides no functional benefit and could obscure historical context."

  - decision: "Keep spec-template.yaml and plan-template.yaml names unchanged"
    rationale: "These template files are user-facing artifacts created in each session. Renaming them would be a separate breaking change affecting all user projects. Out of scope for this focused rename."

# FILE STRUCTURE
# List all files to be created or modified during implementation

files_to_create: []

files_to_modify:
  - path: "src/scripts/bash/create-spec-files.sh"
    change_type: "rename"
    description: "Rename to create-session-files.sh using git mv"

  - path: "src/scripts/powershell/create-spec-files.ps1"
    change_type: "rename"
    description: "Rename to create-session-files.ps1 using git mv, update internal usage strings"

  - path: "src/templates/commands/plan.md"
    change_type: "edit"
    description: "Update script invocation paths in scripts section (lines 5-6)"

  - path: ".buildforce/context/plan-command.yaml"
    change_type: "edit"
    description: "Update 5 references to script names in dependencies and files sections"

  - path: ".buildforce/context/state-tracking.yaml"
    change_type: "edit"
    description: "Update 1 reference in secondary files section"

  - path: ".buildforce/context/_guidelines.yaml"
    change_type: "edit"
    description: "Update 1 example path reference"

  - path: ".buildforce/context/template-versioning.yml"
    change_type: "edit"
    description: "Update 1 example reference"

# IMPLEMENTATION PHASES
# Break down the implementation into logical phases with checkbox-based task tracking
# Use [ ] for pending tasks and [x] for completed tasks
# Each task should link back to spec requirements via spec_refs

phase_1:
  name: "Rename Script Files"
  description: |
    Rename both bash and PowerShell scripts using git mv to preserve file history.
    Update internal usage strings in PowerShell script. This phase establishes the
    new filenames that subsequent phases will reference.

  tasks:
    - [x] Rename bash script from create-spec-files.sh to create-session-files.sh
      spec_refs: [FR1, NFR1]
      files: [src/scripts/bash/create-spec-files.sh]
      notes: "Use: git mv src/scripts/bash/create-spec-files.sh src/scripts/bash/create-session-files.sh"

    - [x] Rename PowerShell script from create-spec-files.ps1 to create-session-files.ps1
      spec_refs: [FR2, NFR1]
      files: [src/scripts/powershell/create-spec-files.ps1]
      notes: "Use: git mv src/scripts/powershell/create-spec-files.ps1 src/scripts/powershell/create-session-files.ps1"

    - [x] Update PowerShell script usage strings to reference new filename
      spec_refs: [FR4, FR7]
      files: [src/scripts/powershell/create-session-files.ps1]
      notes: "Lines 17-18: Update error message examples from create-spec-files.ps1 to create-session-files.ps1"

  validation:
    - [x] All phase_1 tasks completed
    - [x] Both scripts renamed with git mv (preserves history)
    - [x] PowerShell usage strings updated
    - [x] Spec requirements covered: [FR1, FR2, FR4, FR7, NFR1]

phase_2:
  name: "Update Template and Context References"
  description: |
    Update all references to the renamed scripts in templates and context documentation.
    This ensures no broken references exist and the /buildforce.plan command can invoke
    the renamed scripts successfully.

  tasks:
    - [x] Update plan.md template script invocations
      spec_refs: [FR3, NFR3]
      files: [src/templates/commands/plan.md]
      notes: "Lines 5-6: Change create-spec-files.sh to create-session-files.sh, create-spec-files.ps1 to create-session-files.ps1"

    - [x] Update plan-command.yaml context references
      spec_refs: [FR5]
      files: [.buildforce/context/plan-command.yaml]
      notes: "Update 5 occurrences in dependencies, files, and evolution sections"

    - [x] Update state-tracking.yaml context reference
      spec_refs: [FR5]
      files: [.buildforce/context/state-tracking.yaml]
      notes: "Update 1 occurrence in secondary files section (line 34)"

    - [x] Update _guidelines.yaml example path
      spec_refs: [FR5]
      files: [.buildforce/context/_guidelines.yaml]
      notes: "Update 1 example path reference (line 74)"

    - [x] Update template-versioning.yml example
      spec_refs: [FR5]
      files: [.buildforce/context/template-versioning.yml]
      notes: "Update 1 example reference (line 126)"

  validation:
    - [x] All phase_2 tasks completed
    - [x] No occurrences of create-spec-files.sh remain in src/ directory
    - [x] No occurrences of create-spec-files.ps1 remain in src/ directory
    - [x] Context files reference correct script names
    - [x] Spec requirements covered: [FR3, FR5, NFR3]

phase_3:
  name: "Validate Functionality"
  description: |
    Test that the renamed scripts function correctly and can be invoked from the
    /buildforce.plan command. Verify all existing functionality preserved.

  tasks:
    - [x] Test bash script invocation directly
      spec_refs: [FR6, FR7, NFR2]
      files: [src/scripts/bash/create-session-files.sh]
      notes: "Run: bash src/scripts/bash/create-session-files.sh --folder-name test-rename-20251126000000 --json"

    - [x] Test PowerShell script invocation directly (skipped - not on Windows)
      spec_refs: [FR6, FR7, NFR2]
      files: [src/scripts/powershell/create-session-files.ps1]
      notes: "Run: src/scripts/powershell/create-session-files.ps1 -FolderName test-rename-20251126000001 -Json (if on Windows)"

    - [x] Verify scripts create session folders successfully
      spec_refs: [FR6]
      files: []
      notes: "Check .buildforce/sessions/ contains new test folders with spec.yaml and plan.yaml"

    - [x] Verify buildforce.json currentSession updated correctly
      spec_refs: [FR6]
      files: []
      notes: "Check .buildforce/buildforce.json has currentSession set to test folder name"

    - [x] Search for any remaining references to old script names
      spec_refs: [NFR3]
      files: []
      notes: "Use: grep -r 'create-spec-files' src/ .buildforce/context/ to ensure no broken references"

  validation:
    - [x] All phase_3 tasks completed
    - [x] Renamed scripts execute successfully
    - [x] Session folders created with correct structure
    - [x] State tracking works correctly
    - [x] No broken references found
    - [x] Spec requirements covered: [FR6, FR7, NFR2, NFR3]

# DEVIATION LOG
# The /buildforce.build agent populates this section when implementation deviates from the original plan
# Format: phase → task → original plan → actual implementation → reason for deviation

deviations: []

# GUIDELINE COMPLIANCE
# Track validation results for strict and recommended enforcement levels
# This section is populated during /buildforce.build when .buildforce/context/_guidelines.yaml exists
# Guidelines are for AI agent education - agents validate their own generated code against project conventions

guideline_compliance:
  strict_validations:
    - guideline: "Template-Only Slash Commands"
      status: "✓ PASS"
      checked_files: [src/templates/commands/plan.md]
      violation: null
      notes: "Script rename does not add command logic to TypeScript - templates remain unchanged in structure"

    - guideline: "Bash Script Context Loading"
      status: "✓ PASS"
      checked_files: [src/scripts/bash/create-session-files.sh]
      violation: null
      notes: "Script designed to be called from project root, uses relative paths"

  recommended_validations:
    - guideline: "Context Repository Pattern"
      status: "✓ PASS"
      checked_files: [.buildforce/context/plan-command.yaml, .buildforce/context/state-tracking.yaml, .buildforce/context/_guidelines.yaml, .buildforce/context/template-versioning.yml]
      deviation: null
      notes: "All context files updated with new script references"

    - guideline: "Error Handling in Templates"
      status: "✓ PASS"
      checked_files: [src/templates/commands/plan.md]
      deviation: null
      notes: "Template maintains existing error handling instructions for AI agents"

# TESTING GUIDANCE
# Structured guidance for testing the implementation

testing:
  automated_tests: []

  manual_tests:
    - scenario: "Test bash script invocation after rename"
      steps: |
        1. Run: bash src/scripts/bash/create-session-files.sh --folder-name test-rename-20251126000000 --json
        2. Verify JSON output contains FOLDER_NAME, SPEC_FILE, PLAN_FILE, SPEC_DIR
        3. Check .buildforce/sessions/test-rename-20251126000000/ exists
        4. Verify spec.yaml and plan.yaml files created from templates
        5. Check .buildforce/buildforce.json has currentSession set to "test-rename-20251126000000"

    - scenario: "Verify plan.md template uses renamed scripts"
      steps: |
        1. Read src/templates/commands/plan.md
        2. Verify line 5 references create-session-files.sh (not create-spec-files.sh)
        3. Verify line 6 references create-session-files.ps1 (not create-spec-files.ps1)
        4. Confirm no occurrences of "create-spec-files" remain in template

    - scenario: "Verify no broken references remain"
      steps: |
        1. Run: grep -r "create-spec-files\.sh" src/ .buildforce/context/
        2. Should return zero results from active files (only historical sessions may contain references)
        3. Run: grep -r "create-spec-files\.ps1" src/ .buildforce/context/
        4. Should return zero results from active files

# VALIDATION CRITERIA
# Define success metrics and track spec requirement coverage

success_metrics:
  - "Zero occurrences of create-spec-files.sh in src/ directory after completion"
  - "Zero occurrences of create-spec-files.ps1 in src/ directory after completion"
  - "/buildforce.plan command successfully creates new sessions using renamed scripts"
  - "All existing script functionality preserved (folder creation, template copying, state updates)"

spec_coverage:
  # Auto-track which spec requirements are implemented in which tasks
  # Format: requirement_id: status + location
  - FR1: "✓ Phase 1: Task 1 - Rename bash script"
  - FR2: "✓ Phase 1: Task 2 - Rename PowerShell script"
  - FR3: "✓ Phase 2: Task 1 - Update plan.md template"
  - FR4: "✓ Phase 1: Task 3 - Update PowerShell usage strings"
  - FR5: "✓ Phase 2: Tasks 2-5 - Update context documentation"
  - FR6: "✓ Phase 3: Tasks 1-4 - Validate functionality preserved"
  - FR7: "✓ Phase 1: Task 3, Phase 3: Tasks 1-2 - Verify behavior unchanged"
  - NFR1: "✓ Phase 1: Tasks 1-2 - Cross-platform compatibility"
  - NFR2: "✓ Phase 3: Tasks 1-2 - No workflow breakage"
  - NFR3: "✓ Phase 2: All tasks - Atomic reference updates"
  - NFR4: "✓ All phases - Internal variables unchanged"

# PROGRESS SUMMARY
# Track overall progress and identify next steps

overall_progress:
  phase_1: "3/3 tasks completed ✓"
  phase_2: "5/5 tasks completed ✓"
  phase_3: "5/5 tasks completed ✓"

current_status: |
  Implementation complete! All three phases finished successfully:
  - Phase 1: Both bash and PowerShell scripts renamed using git mv, usage strings updated
  - Phase 2: All template and context file references updated (5 files)
  - Phase 3: Bash script tested and verified, no broken references found

  Ready for final review and commit.

next_immediate_steps:
  - "Review changes with git diff to verify all renames"
  - "Create commit with message documenting the rename"
  - "Push changes to remote repository"

# RISKS & CONSIDERATIONS
# Document potential risks and mitigation strategies

risks:
  - risk: "Breaking /buildforce.plan command if references not updated atomically"
    mitigation: "All changes made in single commit. Phase 2 updates all references together. Validate with grep before committing."

  - risk: "Historical session files may cause confusion with old script names"
    mitigation: "Document in commit message that historical sessions are intentionally unchanged. Add note in plan-command.yaml evolution section."

  - risk: "External tools or user scripts may directly invoke create-spec-files.sh"
    mitigation: "Assumption: no active users exist. If this becomes an issue, can add deprecated wrapper scripts that call renamed versions."

# NOTES
# Capture lessons learned and future enhancement ideas

general_notes:
  - "This rename completes the terminology migration from 'spec' to 'session' across the codebase"
  - "Previous migrations: v1.1 renamed folders, v1.2 renamed state fields, v9.0 renamed command"
  - "Historical session files in .buildforce/sessions/ are intentionally left unchanged"
  - "Use git mv to preserve file history and make rename operation explicit"
  - "All reference updates must happen atomically in single commit to prevent broken state"

lessons_learned:
  - "Phased terminology migrations create cognitive overhead and conceptual friction"
  - "Keeping script names as 'internal implementation details' was pragmatic but incomplete"
  - "Low-risk breaking changes are easier to implement when no active users exist"
  - "Research phase provides valuable context about historical decisions and their rationale"

future_enhancements:
  - "Consider renaming spec.yaml to session.yaml in future (would be major breaking change)"
  - "Evaluate renaming plan-template.yaml and spec-template.yaml for full consistency"
  - "Add deprecation warnings if external tools are found invoking old script names"
  - "Document terminology migration journey in README.md or CHANGELOG.md"
