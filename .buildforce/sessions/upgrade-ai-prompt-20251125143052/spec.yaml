version: "0.0.35"
id: upgrade-ai-prompt-20251125143052
name: "Add AI Selection Prompts to Upgrade Command"
type: feature
status: ready
created: "2025-11-25"
last_updated: "2025-11-25"

summary: |
  Add interactive AI assistant selection prompts to the upgrade command, providing the same user experience as the init command.

# INTENT / PROBLEM STATEMENT

problem: |
  The upgrade command currently only prompts for AI assistant selection when the configuration is completely missing.
  If a user has an existing configuration with AI assistants, they cannot interactively modify or add new assistants
  during the upgrade process like they can during initialization. This creates an inconsistent user experience
  between init and upgrade commands.

motivation: |
  Users should have the same level of interactivity and control during upgrades as they do during initialization.
  This allows users to easily add new AI assistants or modify their selection when upgrading their project,
  without needing to manually edit buildforce.json or use CLI flags.

# GOALS

primary_goals:
  - Provide interactive AI assistant selection prompts during upgrade, matching the init command behavior
  - Maintain backward compatibility with existing CLI flags and configuration detection

secondary_goals:
  - Ensure consistent user experience between init and upgrade commands
  - Allow users to easily modify their AI assistant selection during upgrades

# REQUIREMENTS

functional_requirements:
  - FR1: Upgrade command should prompt for AI assistant selection even when configuration exists
  - FR2: Users should be able to use spacebar to select/deselect AI assistants and enter to confirm, matching init behavior
  - FR3: CLI flag --ai should still override interactive prompts for non-interactive usage
  - FR4: Default selected assistants in the prompt should be those currently configured in buildforce.json
  - FR5: Prompt should use the same selectMultipleWithCheckboxes interface as init command

non_functional_requirements:
  - NFR1: Changes should not break existing upgrade command functionality or CLI flags
  - NFR2: User experience should be consistent with init command's AI selection flow
  - NFR3: Code changes should follow existing patterns in the codebase

# SCOPE

in_scope:
  - Modify upgrade command to always prompt for AI assistant selection (unless --ai flag is provided)
  - Pre-select existing AI assistants from buildforce.json in the interactive prompt
  - Update messaging to indicate when assistants are being modified vs. newly selected

out_of_scope:
  - Changes to init command behavior
  - Changes to script type selection logic
  - Migration of buildforce.json format or structure
  - Changes to AI assistant validation logic

# DESIGN PRINCIPLES

design_principles:
  - "Maintain consistency: upgrade should feel like init in terms of interactivity"
  - "Preserve flexibility: CLI flags should still work for automation/scripting"
  - "Default to existing: pre-select current configuration as sensible default"

# ACCEPTANCE CRITERIA

acceptance_criteria:
  - AC1: Running `buildforce upgrade` without --ai flag prompts for AI assistant selection with checkboxes
  - AC2: The prompt pre-selects assistants currently configured in buildforce.json
  - AC3: Running `buildforce upgrade --ai claude` skips the prompt and uses the CLI-provided value
  - AC4: Users can select multiple AI assistants using spacebar and enter, just like in init
  - AC5: The upgrade command completes successfully with the selected AI assistants

# ASSUMPTIONS & DEPENDENCIES

assumptions:
  - Users have TTY/interactive terminal when running upgrade without --ai flag
  - The selectMultipleWithCheckboxes function works correctly for the upgrade command context
  - buildforce.json exists and is readable (validated by prerequisite checks)

dependencies:
  internal:
    - src/lib/interactive.ts: "Uses selectMultipleWithCheckboxes for AI selection"
    - src/commands/upgrade/index.ts: "Main file requiring modifications"
    - src/constants.ts: "Defines AI_CHOICES for selection"
  external: []

# OPEN QUESTIONS

open_questions:
  - RESOLVED: Show different messaging to provide context (e.g., "Choose your AI assistant(s) (current: claude):")
  - RESOLVED: Use upgrade-specific wording (e.g., "Modify your AI assistant(s)")

# NOTES

notes: |
  The upgrade command already has the infrastructure for interactive prompts (lines 92-104 in index.ts).
  The change is primarily about when to show the prompt (always vs. only when missing) and what to pre-select.

  Current behavior:
  - Prompts ONLY when config?.aiAssistants is missing or empty
  - Shows: "No AI assistant found in buildforce.json. Please select one or more:"

  Desired behavior:
  - Prompts when --ai flag is not provided (regardless of existing config)
  - Pre-selects existing config?.aiAssistants as defaults
  - Shows appropriate messaging based on whether config exists
