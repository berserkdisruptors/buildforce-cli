version: "0.0.38"
id: standalone-build-mode-20251202174500-plan
name: "Implementation Plan for Standalone Build Mode"
spec_id: "standalone-build-mode-20251202174500"
type: implementation-plan
status: completed
created: "2025-12-02"
last_updated: "2025-12-02"

# ARCHITECTURE OVERVIEW

approach: |
  Extend the existing build.md template by adding conditional logic in guideline #1 (Script Execution
  & Context Loading). When SPEC_DIR is empty, branch into standalone mode flow instead of failing.
  The standalone flow follows a compressed version of the full workflow: explore → plan → clarify →
  confirm → implement → summarize → optionally document. All changes are template-only, no new
  scripts or TypeScript code required.

technology_stack:
  - Markdown template: build.md instruction template for AI agents
  - Existing bash scripts: get-spec-paths.sh for SPEC_DIR detection (no changes)
  - YAML context files: _index.yaml and context files for documentation

decisions:
  - decision: "Add standalone mode as conditional branch in guideline #1"
    rationale: "Guideline #1 already handles script execution and context loading. The SPEC_DIR check is the natural branching point. Keeping mode selection in one place prevents scattered conditionals."

  - decision: "Create new guidelines S1-S7 for standalone mode flow"
    rationale: "Clear separation between full mode (guidelines 2-8) and standalone mode (S1-S7). Numbered guidelines match existing pattern and make the flow explicit."

  - decision: "Reuse guideline #8 (Guideline Compliance) for both modes"
    rationale: "Project guidelines should apply regardless of mode. Code quality is mode-independent."

  - decision: "Present plan before confirmation, not after exploration"
    rationale: "User needs to see what will be done before agreeing. Exploration informs the plan, plan informs the decision."

  - decision: "Use inline significance heuristics instead of external config"
    rationale: "Significance determination is contextual and subjective. Embedding heuristics in the template allows agent flexibility rather than rigid rules."

# FILE STRUCTURE

files_to_create: []

files_to_modify:
  - path: "src/templates/commands/build.md"
    change_type: "edit"
    description: "Add standalone mode conditional logic after SPEC_DIR check, add S1-S7 guidelines for standalone flow, add mode indicator, add summary format"

  - path: ".buildforce/context/build-command.yaml"
    change_type: "edit"
    description: "Update context documentation to reflect new standalone mode capability (post-implementation)"

  - path: "README.md"
    change_type: "edit"
    description: "Add standalone build mode as a workflow scenario, update /buildforce.build command section with dual-mode documentation"

# IMPLEMENTATION PHASES

phase_1:
  name: "Mode Detection & Branching"
  description: |
    Modify guideline #1 to add conditional branching based on SPEC_DIR.
    When empty, display mode indicator and check for $ARGUMENTS.

  tasks:
    - [x] Update guideline #1 to handle empty SPEC_DIR case
      spec_refs: [FR1, FR12]
      files: [src/templates/commands/build.md]
      notes: "Add conditional after JSON parsing: if SPEC_DIR empty, enter standalone mode"

    - [x] Add mode indicator display for standalone mode
      spec_refs: [FR12, AC3]
      files: [src/templates/commands/build.md]
      notes: "Display: 'Standalone Mode - No active session' with visual separator"

    - [x] Add $ARGUMENTS check in standalone branch
      spec_refs: [FR2, AC2]
      files: [src/templates/commands/build.md]
      notes: "If $ARGUMENTS empty, prompt user for implementation goal"

  validation:
    - [x] All phase_1 tasks completed
    - [x] Mode indicator displays when no session
    - [x] Empty $ARGUMENTS prompts for goal
    - [x] Spec requirements covered: [FR1, FR2, FR12]

phase_2:
  name: "Standalone Flow Guidelines (S1-S4)"
  description: |
    Add standalone-specific guidelines for exploration, planning,
    clarification, and confirmation steps.

  tasks:
    - [x] Add guideline S1: Quick Exploration
      spec_refs: [FR3, AC4]
      files: [src/templates/commands/build.md]
      notes: "Search codebase for related files, assess impact (Low/Medium/High), identify dependencies"

    - [x] Add guideline S2: Present Plan
      spec_refs: [FR4, FR13, AC5, AC11]
      files: [src/templates/commands/build.md]
      notes: "Format: Goal, Files to Modify, Approach (1-3 bullets), Risks. If high complexity, suggest /buildforce.spec"

    - [x] Add guideline S3: Clarify if Ambiguous
      spec_refs: [FR5]
      files: [src/templates/commands/build.md]
      notes: "Max 2 clarifying questions if multiple valid approaches. Skip if clear."

    - [x] Add guideline S4: Confirm with User
      spec_refs: [FR6, AC6]
      files: [src/templates/commands/build.md]
      notes: "Request explicit confirmation before proceeding"

  validation:
    - [x] All phase_2 tasks completed
    - [x] Exploration identifies relevant files
    - [x] Plan format is clear and actionable
    - [x] Clarification triggers only when needed
    - [x] Spec requirements covered: [FR3, FR4, FR5, FR6, FR13]

phase_3:
  name: "Standalone Flow Guidelines (S5-S7)"
  description: |
    Add standalone-specific guidelines for implementation,
    summary presentation, and context creation.

  tasks:
    - [x] Add guideline S5: Implement
      spec_refs: [FR7]
      files: [src/templates/commands/build.md]
      notes: "Execute the confirmed plan, track what was actually done"

    - [x] Add guideline S6: Present Summary & Testing Guidance
      spec_refs: [FR9, AC8]
      files: [src/templates/commands/build.md]
      notes: "Structured summary: Goal, Approach, Files Changed, Deviations, Testing, Context Updated"

    - [x] Add guideline S7: Update Context Repository (if significant)
      spec_refs: [FR10, FR11, AC9, AC10]
      files: [src/templates/commands/build.md]
      notes: "Include significance heuristics inline. Create context file + update _index.yaml if warranted."

  validation:
    - [x] All phase_3 tasks completed
    - [x] Summary format is comprehensive
    - [x] Context creation logic includes heuristics
    - [x] Spec requirements covered: [FR7, FR9, FR10, FR11]

phase_4:
  name: "Guideline Compliance Integration"
  description: |
    Ensure _guidelines.yaml compliance checking applies to standalone mode.
    Reuse existing guideline #8 logic.

  tasks:
    - [x] Add note in standalone flow to apply guideline #8 compliance check
      spec_refs: [FR8, AC7]
      files: [src/templates/commands/build.md]
      notes: "Reference existing guideline #8 from standalone S5 (Implement) step"

    - [x] Verify full mode (guidelines 2-8) remains unchanged
      spec_refs: [AC12]
      files: [src/templates/commands/build.md]
      notes: "Ensure no regressions to session-based workflow"

  validation:
    - [x] All phase_4 tasks completed
    - [x] Compliance checking works in standalone mode
    - [x] Full workflow mode unaffected
    - [x] Spec requirements covered: [FR8]

phase_5:
  name: "Context Documentation Update"
  description: |
    Update build-command.yaml context file to document the new
    standalone mode capability.

  tasks:
    - [x] Update .buildforce/context/build-command.yaml
      spec_refs: [NFR1]
      files: [.buildforce/context/build-command.yaml]
      notes: "Add standalone_mode section, update summary, add evolution entry"

  validation:
    - [x] All phase_5 tasks completed
    - [x] Context file accurately reflects new capability
    - [x] All NFRs satisfied

phase_6:
  name: "README Documentation Update"
  description: |
    Update README.md to document the new standalone build mode feature,
    adding it as a workflow scenario with usage examples.

  tasks:
    - [x] Add standalone workflow scenario to "Three workflow scenarios" section
      spec_refs: [FR14, AC13]
      files: [README.md]
      notes: "Add as 5th workflow scenario: Standalone workflow for quick ad-hoc changes"

    - [x] Update /buildforce.build command section with dual-mode behavior
      spec_refs: [FR14, AC13]
      files: [README.md]
      notes: "Document that build works with or without active session, explain mode detection"

    - [x] Add standalone mode examples to /buildforce.build section
      spec_refs: [FR14, AC13]
      files: [README.md]
      notes: "Add examples showing standalone usage without /buildforce.plan"

  validation:
    - [x] All phase_6 tasks completed
    - [x] README documents standalone mode workflow scenario
    - [x] /buildforce.build section explains dual-mode behavior
    - [x] Examples show both session and standalone usage

# DEVIATION LOG

deviations:
  - original: "NFR1: Standalone mode should add minimal template lines (~30-40 lines of new content)"
    actual: "Standalone mode added ~50 lines of new content to build.md (template went from 43 to ~90 lines)"
    reason: "The standalone mode flow requires 7 guidelines (S1-S7) with their descriptions, plus mode selection logic, mode indicator, and visual separation between modes. The added clarity and explicit flow steps justify the slightly larger footprint. The template remains readable and well-organized with clear section headers."

# GUIDELINE COMPLIANCE

guideline_compliance:
  strict_validations: []
  recommended_validations: []

# TESTING GUIDANCE

testing:
  automated_tests: []

  manual_tests:
    - scenario: "Standalone mode activation"
      steps: |
        1. Ensure no active session (buildforce.json currentSession is null)
        2. Run /buildforce.build add logging to the init command
        3. Verify mode indicator displays
        4. Verify exploration runs
        5. Verify plan is presented
        6. Confirm and verify implementation proceeds
        7. Verify summary is presented

    - scenario: "Empty arguments handling"
      steps: |
        1. Ensure no active session
        2. Run /buildforce.build with no arguments
        3. Verify agent prompts for implementation goal

    - scenario: "Full mode still works"
      steps: |
        1. Create a session with /buildforce.spec
        2. Run /buildforce.build
        3. Verify full workflow mode activates (loads spec/plan/research)
        4. Verify no standalone mode indicator

    - scenario: "Context creation for significant change"
      steps: |
        1. Run standalone /buildforce.build with a new feature
        2. Verify context file created in .buildforce/context/
        3. Verify _index.yaml updated

    - scenario: "Context skipped for trivial change"
      steps: |
        1. Run standalone /buildforce.build to fix a typo
        2. Verify no context file created

# VALIDATION CRITERIA

success_metrics:
  - "Standalone mode activates without error when no session exists"
  - "Full workflow mode continues to work unchanged"
  - "Template increase is ~30-40 lines (within NFR1)"
  - "All 13 functional requirements verified"
  - "All 12 acceptance criteria met"

spec_coverage:
  - FR1: "✓ Phase 1: Task 1"
  - FR2: "✓ Phase 1: Task 3"
  - FR3: "✓ Phase 2: Task 1"
  - FR4: "✓ Phase 2: Task 2"
  - FR5: "✓ Phase 2: Task 3"
  - FR6: "✓ Phase 2: Task 4"
  - FR7: "✓ Phase 3: Task 1"
  - FR8: "✓ Phase 4: Task 1"
  - FR9: "✓ Phase 3: Task 2"
  - FR10: "✓ Phase 3: Task 3"
  - FR11: "✓ Phase 3: Task 3"
  - FR12: "✓ Phase 1: Task 2"
  - FR13: "✓ Phase 2: Task 2"
  - FR14: "✓ Phase 6: Tasks 1-3"
  - NFR1: "✓ Phase 5: Task 1"
  - NFR2: "✓ Phase 1: Task 1"
  - NFR3: "✓ Phase 2-3: All tasks"
  - NFR4: "✓ Phase 3: Task 3"
  - AC13: "✓ Phase 6: Tasks 1-3"

# PROGRESS SUMMARY

overall_progress:
  phase_1: "3/3 tasks completed"
  phase_2: "4/4 tasks completed"
  phase_3: "3/3 tasks completed"
  phase_4: "2/2 tasks completed"
  phase_5: "1/1 tasks completed"
  phase_6: "3/3 tasks completed"

current_status: |
  All implementation complete. All 16 tasks completed across 6 phases.
  - build.md updated with standalone mode (S1-S7 guidelines)
  - build-command.yaml context file updated with v5.0 evolution entry
  - README.md updated with standalone workflow scenario and dual-mode documentation
  - One deviation logged (template size exceeded estimate)

next_immediate_steps:
  - "Manual testing: verify standalone mode activates without session"
  - "Manual testing: verify full workflow mode still works with session"
  - "Run /buildforce.complete to finalize"

# RISKS & CONSIDERATIONS

risks:
  - risk: "Template becomes too long and complex"
    mitigation: "Use clear section headers and numbered guidelines (S1-S7). Keep each guideline focused."

  - risk: "Users default to standalone for complex features"
    mitigation: "Agent suggests /buildforce.spec for high complexity. Mode indicator reminds user of context."

  - risk: "Context file bloat from many standalone builds"
    mitigation: "Significance heuristics ensure only meaningful changes create context. Agent skips trivial changes."

  - risk: "Guideline compliance not enforced in standalone"
    mitigation: "Explicitly reference guideline #8 from standalone flow. Same compliance checks apply."

# NOTES

general_notes:
  - "Standalone guidelines (S1-S7) are separate from full mode guidelines (2-8) for clarity"
  - "Guideline #1 becomes the mode router - checks SPEC_DIR and branches accordingly"
  - "Guideline #8 (compliance) is shared between modes"
  - "Context creation follows /document command patterns for consistency"

lessons_learned: []

future_enhancements:
  - "Add --promote flag to convert standalone work into a session"
  - "Add --no-context flag to skip context creation entirely"
  - "Consider complexity scoring to better inform workflow suggestions"
