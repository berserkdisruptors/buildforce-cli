id: 003-plan-template
name: "Enhanced Plan Template for Build Agent Execution"
type: feature
status: completed
created: "2025-10-09"
last_updated: "2025-10-09"

summary: |
  Enhance the plan-template.yaml to support bulletproof progress tracking for AI build agents,
  including checkbox-based task tracking, deviation logging, spec traceability, and validation checklists.

# INTENT / PROBLEM STATEMENT

problem: |
  The current plan-template.yaml is designed for human planning but lacks the structure needed for
  AI agent-driven execution during /build commands. Key gaps include:
  - No checkbox-style progress tracking (uses status fields instead)
  - No deviation logging mechanism for transparency during implementation
  - No spec requirement traceability (can't link tasks to spec requirements)
  - No per-phase validation checklists
  - Weak file path references (separate section instead of per-task)
  - No implementation notes field for agent learnings
  - Includes unnecessary fields for agent execution (timestamps, assignees, session logs)

motivation: |
  The /build command requires a plan template optimized for AI agent consumption and real-time
  execution tracking. The enhanced template will enable:
  - Clear progress visibility through checkbox tracking
  - Transparent deviation logging for iterative refinement
  - Traceable implementation against spec requirements
  - Structured validation at each phase
  - Better support for multi-iteration builds
  - Clearer file organization per task

# GOALS

primary_goals:
  - Replace status-based tracking with checkbox-based progress tracking
  - Add deviation logging mechanism for build transparency
  - Enable spec requirement traceability via spec_refs
  - Add per-phase validation checklists
  - Optimize template structure for AI agent execution

secondary_goals:
  - Remove unnecessary fields (timestamps, assignees, session logs)
  - Add per-task file references and implementation notes
  - Improve test guidance structure
  - Add spec coverage tracking section

# REQUIREMENTS

functional_requirements:
  - FR1: Template must use checkbox format `[ ]` / `[x]` for task tracking
  - FR2: Template must include a deviations section for logging Original → Actual → Reason
  - FR3: Each task must support spec_refs array linking to spec requirements
  - FR4: Each phase must include a validation checklist section
  - FR5: Each task must support files array for file path references
  - FR6: Each task must support notes field for implementation notes
  - FR7: Template must include spec_coverage section tracking requirement implementation status
  - FR8: Template structure must remain valid YAML
  - FR9: Template must be backward compatible with existing /plan and /build commands

non_functional_requirements:
  - NFR1: Template must be human-readable for /plan command usage
  - NFR2: Template structure must be parseable by AI agents without ambiguity
  - NFR3: Template should minimize cognitive load during agent execution
  - NFR4: Template comments should provide clear guidance for filling each section

# SCOPE

in_scope:
  - Modify src/templates/plan-template.yaml structure
  - Add checkbox-based task tracking format
  - Add deviation logging section
  - Add spec_refs field to tasks
  - Add validation checklists per phase
  - Add files and notes fields to tasks
  - Add spec_coverage section
  - Restructure testing guidance
  - Remove agent-irrelevant fields

out_of_scope:
  - Modifications to /build or /plan command logic
  - Changes to spec-template.yaml
  - Automated progress calculation logic
  - Web UI for plan visualization
  - Integration with external project management tools

# DESIGN PRINCIPLES

design_principles:
  - "Agent-first design: optimize for AI consumption and execution"
  - "Transparency: make deviations and progress explicitly visible"
  - "Traceability: link every task back to spec requirements"
  - "Simplicity: remove unnecessary complexity and fields"
  - "Validation-driven: embed validation checkpoints at each phase"

# ACCEPTANCE CRITERIA

acceptance_criteria:
  - AC1: Template uses checkbox syntax for all task lists
  - AC2: Deviations section exists with clear structure for logging changes
  - AC3: All tasks include spec_refs, files, and notes fields
  - AC4: All phases include validation checklists
  - AC5: Spec_coverage section tracks requirement implementation status
  - AC6: Template remains valid YAML and parseable
  - AC7: Template comments provide clear usage guidance
  - AC8: Existing /plan and /build commands work with new template structure

# ASSUMPTIONS & DEPENDENCIES

assumptions:
  - /build command will parse checkbox syntax for progress tracking
  - AI agents can update YAML files with checkbox state changes
  - Spec requirements use ID format (e.g., FR1, NFR1, req-1)
  - Plan template consumers understand checkbox conventions

dependencies:
  internal:
    - /build command: "Consumes plan.yml for implementation execution"
    - /plan command: "Generates plan.yml from plan-template.yaml"
    - spec-template.yaml: "Source of spec_refs IDs"
  external:
    - None

# OPEN QUESTIONS

open_questions:
  - Should we support nested task hierarchies or keep flat task lists?
  - Should deviations be logged per-task or in a central section? (Current: central section)
  - Should we add task priority/ordering fields for future sequencing?
  - Should validation checklists be standardized or customizable per phase?

# NOTES

notes: |
  This spec uses itself as a reference implementation - the corresponding plan.yml will use
  the enhanced template structure to plan its own implementation (meta-planning).

  The enhanced template should maintain the human-readable structure for /plan command while
  optimizing for agent execution during /build command.

  Future enhancements could include automated progress calculation, dependency tracking between
  tasks, and integration with testing frameworks for automatic validation.
