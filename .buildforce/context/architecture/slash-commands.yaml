id: slash-commands
name: "Slash Commands System"
type: structural
status: production
created: "2025-01-15"
last_updated: "2026-02-02"

summary: |
  Spec-driven development workflow implemented via 4 core slash commands plus 2 utility commands.
  Core workflow: Research → Spec → Build → Complete lifecycle.
  Utility: Document command for creating context files without specs.
  Utility: Extract command (Claude Code only) for bootstrapping context repositories from fresh codebases.
  Commands are instruction templates that enhance user queries with workflow-specific context.
  All commands now follow proven compact pattern with numbered guidelines and script-based discovery.

responsibilities:
  - Context gathering and project knowledge retrieval (RESEARCH - see research-slash-command.yaml for details, 27 lines)
  - Intent materialization into specifications (SPEC - creates/updates both spec.yaml and plan.yaml)
  - Guided implementation with progress tracking and deviation logging (BUILD - see 002-build-command.yaml for details, 32 lines)
  - Final validation and completion confirmation (COMPLETE - 44 lines)
  - Context file creation for existing functionality without specs (DOCUMENT - see 005-new-document-slash.yaml for details, 29 lines)

dependencies:
  internal:
    - context-repository: "RESEARCH searches .buildforce/context/_index.yaml for accumulated knowledge; DOCUMENT creates/updates context files; COMPLETE generates context files for completed specs"
    - cli-architecture: "Slash commands initialized via project templates distributed by the CLI"
  external:
    - None (pure instruction templates for Claude Code)

files:
  primary:
    - src/templates/commands/research.md
    - src/templates/commands/plan.md
    - src/templates/commands/build.md
    - src/templates/commands/complete.md
    - src/templates/commands/document.md
    - src/templates/commands/extract.md
  secondary:
    - src/templates/agents/cm-1-structural.md
    - src/templates/agents/cm-2-convention.md
    - src/templates/agents/cm-3-verification.md
    - .buildforce/context/_index.yaml (searched by RESEARCH, updated by DOCUMENT, COMPLETE, and EXTRACT)

workflow:
  sequence:
    - command: "/research"
      purpose: "Gather context for spec-driven development session"
      input: "User query (what to research)"
      output: "Structured report with project context, file paths, architecture diagrams, data models"
      key_features:
        - "Searches .buildforce/context/_index.yaml first (accumulated knowledge)"
        - "Detects recency indicators � uses web search"
        - "Produces Mermaid diagrams for codebase queries"
        - "Explicit file path lists (saves manual @ references)"

    - command: "/buildforce.plan"
      purpose: "Materialize user intent into specification (WHAT) and plan (HOW)"
      input: "User intent (the concrete incremental change)"
      output: "Spec (WHAT) and Plan (HOW) with requirements, scope, decisions, phases"
      key_features:
        - "Validates prerequisite context (suggests /research if needed)"
        - "Asks up to 3 clarifying questions if intent is vague"
        - "Ensures requirements are testable and measurable"
        - "Generates plan.yaml alongside spec.yaml using plan-template"

    - command: "/build"
      purpose: "Execute implementation following spec+plan"
      input: "Iteration-specific instructions (optional)"
      output: "Implementation + deviation log + testing guidance"
      key_features:
        - "Executes `.buildforce/scripts/bash/get-spec-paths.sh --json` for FEATURE_DIR discovery"
        - "Loads spec.yaml and plan.yaml from FEATURE_DIR into context"
        - "Tracks progress step-by-step with visible checklist"
        - "Logs deviations from original plan (e.g., library swaps)"
        - "Validates against BOTH spec requirements AND plan adherence"
        - "Verifies code quality (compiles, tests pass, no obvious gaps)"
        - "Provides testing guidance (what to test, how to test, test results)"
        - "Supports multiple iterations with refinement"

    - command: "/complete"
      purpose: "Finalize feature and validate intent match"
      input: "None (optional final notes)"
      output: "Completion report with validation, deviations, files modified"
      key_features:
        - "Validates all spec requirements implemented"
        - "Reviews deviation log across all /build iterations"
        - "Generates comprehensive completion report"
        - "Requires explicit user confirmation"

  utility_commands:
    - command: "/document"
      purpose: "Create or update context files for existing functionality without specs"
      input: "Topic or module to document (information assumed in context window)"
      output: "Context file + _index.yaml update + related context updates"
      key_features:
        - "Operates independently of spec-driven workflow (no spec/plan/build required)"
        - "Template-only (no script execution like /research)"
        - "Auto-detects context type (module/feature/component/pattern)"
        - "Generates snake-case filenames (2-3 words, NO numeric prefixes)"
        - "Detects and resolves ID conflicts automatically"
        - "Supports CREATE mode (new files) and UPDATE mode (intelligent merge)"
        - "Auto-generates tags for _index.yaml from topic analysis"
        - "Automatically updates related context files with cross-references"
        - "Uses 7 numbered guidelines with ALWAYS/NEVER emphasis (29 lines)"

    - command: "/buildforce.extract"
      purpose: "Bootstrap context repository from fresh codebases (Claude Code only)"
      input: "Optional focus prompt for targeted extraction"
      output: "Context files + _index.yaml coverage map updates"
      key_features:
        - "Claude Code only (uses Task tool for sub-agent spawning)"
        - "Context Manager + Context Extractors architecture"
        - "Parallel extraction across architecture, conventions, verification domains"
        - "Iterative depth model (none → shallow → moderate → deep)"
        - "Extractors return proposals validated by Context Manager before writing"
        - "Root _index.yaml serves as both index AND coverage map"
        - "Solves cold start problem for new repositories"
        - "Template: 167 lines with embedded sub-agent prompts"

design_principles:
  - "Compact but powerful: Enhance user queries without teaching build agents HOW to work"
  - "Context-first: Always search project context repository before other research"
  - "Incremental: Focus on single, focused changes, not complete rewrites"
  - "Traceable: Log deviations, track progress, validate against spec"
  - "Iterative: Support refinement at every stage (spec, plan, build)"

evolution:
  - version: "1.0"
    date: "2025-01-15"
    changes: "Initial implementation of 5-command workflow with project context search"

  - version: "1.1"
    date: "2025-10-08"
    changes: "Completed BUILD command with 7 guidelines, script-based discovery, dual validation, testing guidance (32 lines, 75% reduction)"

  - version: "1.2"
    date: "2025-10-09"
    changes: "Enhanced plan-template.yaml v1.0 with checkbox tracking, spec_refs, deviation logging, validation checklists"

  - version: "2.0"
    date: "2025-10-10"
    changes: "Spec now owns plan creation/update; /plan command retired. Workflow simplified to 4 core commands."

  - version: "2.1"
    date: "2025-10-10"
    changes: "Added /document utility command (29 lines) for creating context files without specs. Enables documenting existing functionality, legacy code, and architectural patterns independently of spec-driven workflow. Template-only with 7 guidelines, snake-case naming, intelligent merge, auto-detection."

  - version: "2.2"
    date: "2026-01-28"
    changes: "Added /buildforce.extract command (Claude Code only) for bootstrapping context repositories from fresh codebases. Uses Context Manager + Context Extractors sub-agent architecture with parallel extraction. Implements iterative depth model and coverage map in _index.yaml. First agent-specific slash command."

related_specs:
  - "slash-commands-20250101120000 (initial system design)"
  - "build-command-20250102120000 (BUILD command implementation)"
  - "plan-template-20250103120000 (enhanced plan template)"
  - "new-document-slash-20250105120000 (DOCUMENT command implementation)"
  - "claude-code-extract-command-20260127152345 (EXTRACT command implementation)"

extension_points:
  adding_new_command: |
    To add a new slash command:
    1. Create src/templates/commands/{name}.md with YAML frontmatter:
       ---
       version: "0.0.42"
       description: Command description for help text
       scripts:
         sh: bash .buildforce/scripts/bash/{script}.sh
         ps: .buildforce/scripts/powershell/{script}.ps1
       ---
    2. Use $ARGUMENTS placeholder for user input
    3. Add supporting scripts to src/scripts/bash/ and src/scripts/powershell/
    4. Optionally add "agents:" field to restrict to specific agents

  agent_specific_commands: |
    Commands can be agent-specific via frontmatter filtering:
    - Add "agents: [claude]" or "agents: [claude, cursor]" to frontmatter
    - Build script filters commands based on current agent
    - Example: extract.md is Claude-only due to Task tool requirement

  sub_agent_creation: |
    Claude Code supports sub-agents for parallel execution:
    1. Create src/templates/agents/{name}.md with frontmatter:
       ---
       name: agent-name
       description: Agent description
       tools: Read, Glob, Grep
       model: inherit
       agents: [claude]
       ---
    2. Sub-agents are deployed to .claude/agents/ during packaging
    3. Spawned via Claude Code's Task tool
    4. Return structured data (typically YAML) to parent command

command_lifecycle:
  template_to_runtime: |
    1. Template created in src/templates/commands/{name}.md
    2. During release packaging (create-release-packages.sh):
       - generate_commands() reads template
       - Checks agents field for filtering
       - Extracts script command for variant (sh/ps)
       - Substitutes {SCRIPT} placeholder
       - Outputs to agent-specific folder with buildforce.{name}.{ext}
    3. User installs via buildforce init
    4. Commands available as /buildforce.{name} in agent

  invocation_flow: |
    User types "/buildforce.{command} {args}" in AI agent:
    1. Agent reads command file from agent folder
    2. $ARGUMENTS variable populated with user input
    3. Command executed - may spawn scripts or sub-agents
    4. Output presented to user, files modified as needed

state_flow_between_commands: |
  Research -> Plan -> Build -> Complete workflow state management:

  1. /buildforce.research (no session required):
     - If currentSession exists: writes to sessions/{session}/research.yaml
     - If no session: writes to .temp/research-cache.yaml

  2. /buildforce.plan (creates session):
     - CREATE mode: Generates folder name with timestamp
     - Runs create-session-files.sh to create folder
     - Sets currentSession in buildforce.json
     - Materializes research-cache.yaml to session/research.yaml
     - Creates spec.yaml and plan.yaml

  3. /buildforce.build (uses session):
     - Reads currentSession from buildforce.json
     - Loads spec.yaml, plan.yaml, research.yaml from session
     - Updates status to "in-progress"
     - Tracks progress in plan.yaml

  4. /buildforce.complete (clears session):
     - Validates all requirements met
     - Creates/updates context files
     - Sets currentSession to null in buildforce.json
     - Session artifacts preserved for history

integration_patterns:
  context_repository: |
    Commands interact with context via _index.yaml:
    - /research: READS domains.*.items to find relevant context
    - /document: WRITES to architecture/ or conventions/
    - /complete: WRITES to architecture/, updates _index.yaml
    - /extract: ORCHESTRATES extraction across all domains

  conventions_integration: |
    Conventions loaded by /plan and enforced by /build:
    - /plan: Reads conventions/_index.yaml, references in decisions
    - /build: Validates strict conventions, logs recommended deviations
    - Convention files in conventions/ with enforcement levels

notes: |
  Key innovation: .buildforce/context repository as primary knowledge source.
  RESEARCH command is foundationprovides context for all subsequent commands.
  Each command expects $ARGUMENTS (Claude Code compatible).

  Compression achievements (v2.1):
  - /research: 27 lines (68% reduction) - 7 guidelines ✅
  - /buildforce.plan: 347 lines (iterated with structured workflow) ✅
  - /build: 32 lines (75% reduction) - 7 guidelines ✅
  - /complete: 44 lines (iterated with structured workflow) ✅
  - /document: 29 lines - 7 guidelines ✅ (new utility command)

  All commands following proven compact pattern:
  - YAML frontmatter with script execution (where applicable)
  - User input section with $ARGUMENTS
  - Context explanation
  - Numbered guidelines (RESEARCH/PLAN/BUILD/DOCUMENT use 7 guidelines)
  - ALWAYS/NEVER bold emphasis for critical instructions
  - No verbose HOW-TO explanations
  - Context reference at bottom

  System now production-ready with complete 5-command core workflow + 1 utility command.

  /document vs /complete context creation:
  - /complete: Creates context files for specs completed through full workflow (research → spec → plan → build → complete)
  - /document: Creates context files for existing functionality WITHOUT specs (legacy code, discovered patterns, architectural decisions)
  - Both follow _schema.yaml structure, update _index.yaml, maintain cross-references
  - /research reads context, /document writes context (natural complement)
