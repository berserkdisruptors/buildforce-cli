id: spec-command
name: "Spec Command Template"
type: feature
status: production
created: 2025-01-23
last_updated: 2025-10-24

summary: |
  Template-based slash command that guides AI agents through creating or updating structured
  specification files. Uses .current-spec state tracking to determine CREATE vs UPDATE mode.
  Delegates semantic-slug-first folder naming to agents in CREATE flow only.

responsibilities:
  - Guide agents through spec creation workflow with 7 structured steps
  - Determine CREATE vs UPDATE mode using .current-spec state file
  - Instruct agents to generate semantic-slug-first folder names (CREATE mode only)
  - Execute create-spec-files script with agent-generated folder name
  - Capture WHAT needs to be built (not HOW) in spec.yaml files
  - Identify ambiguities and prompt for clarifying questions using standardized format
  - Validate prerequisite context from /research commands

dependencies:
  internal:
    - create-spec-files.sh: "Bash script for creating spec folder structure"
    - create-spec-files.ps1: "PowerShell equivalent for cross-platform support"
    - spec-template.yaml: "Template structure for new spec files"
    - .current-spec: "State file tracking active spec folder name"
  external:
    - None (template-only command)

files:
  primary:
    - src/templates/commands/spec.md
  secondary:
    - src/scripts/bash/create-spec-files.sh
    - src/scripts/powershell/create-spec-files.ps1
    - src/templates/spec-template.yaml

command_signature:
  syntax: "/spec [feature-description]"
  arguments:
    - name: "feature-description"
      type: "string"
      required: false
      description: "Brief description of the feature to spec (can be provided in follow-up)"
  examples:
    - "/spec Add JWT authentication with refresh tokens"
    - "/spec Refactor error handling middleware"

design_decisions:
  - decision: "Use .current-spec file for CREATE vs UPDATE determination"
    rationale: "Simpler and more reliable than external pattern files. Single source of truth for active spec state."

  - decision: "Move folder name generation to CREATE flow only"
    rationale: "UPDATE mode doesn't need new folder names - it modifies existing spec. Reduces complexity and avoids confusion."

  - decision: "Remove create-update-pattern.md reference"
    rationale: "Legacy file didn't exist and caused confusion. Direct .current-spec check is self-explanatory."

  - decision: "Timestamp generation in agent, not script"
    rationale: "Agent needs timestamp to construct full folder name before passing to script. Allows deterministic naming within conversation session."

  - decision: "Remove fuzzy search mentions"
    rationale: "Fuzzy matching removed from scripts entirely. No longer relevant to command workflow."

  - decision: "Semantic-first folder naming (slug-timestamp instead of timestamp-slug)"
    rationale: "Improves discoverability, IDE autocomplete, and aligns with context file naming philosophy. Timestamp suffix maintains uniqueness while prioritizing human-readable semantic information."

  - decision: "Standardized clarifying question format (numeric questions + alphabetical options + X for Other)"
    rationale: "Reduces user cognitive load and confusion by providing consistent, predictable structure for question responses. Format uses 1,2,3 numbering, A,B,C options, and X for free-form answers. Applied when predefined options make sense, with flexibility for plain text questions when appropriate."

evolution:
  - version: "1.0"
    date: "2025-01-07"
    changes: "Initial template with agent-driven folder name generation and script parameter passing"

  - version: "2.0"
    date: "2025-01-23"
    changes: "Refactored to use .current-spec for CREATE/UPDATE determination, moved folder generation to CREATE flow only, removed legacy references"

  - version: "3.0"
    date: "2025-10-24"
    changes: "Reversed naming convention from {timestamp}-{slug} to {slug}-{timestamp} for improved discoverability and IDE autocomplete. Updated validation to enforce semantic slug starting with letter."

  - version: "4.0"
    date: "2025-10-24"
    changes: "Added standardized clarifying question format to Step 4 with explicit formatting rules (numeric questions, alphabetical options A/B/C, X for Other), format template, 2 complete examples, and usage guidance. Improves UX consistency and reduces user confusion during spec clarification phase."

related_specs:
  - redesign-spec-context-20250107120000
  - swap-timestamp-slug-order-20251024093000
  - standardize-question-format-20251024000000

notes: |
  The /spec command follows a 7-step workflow:
  1. Determine CREATE vs UPDATE mode (check .current-spec)
  2. For CREATE: Generate folder name, run script, populate spec
  3. For UPDATE: Load existing spec, merge new information
  4. Validate prerequisite context
  5. Identify ambiguities and clarifying questions
  6. Apply behavior rules (focus on WHAT not HOW)
  7. Report completion

  Folder naming format for CREATE mode:
  - Semantic slug: kebab-case, 3-5 words, max 35 chars, must start with letter
  - Timestamp: YYYYMMDDHHmmss (14 digits, UTC)
  - Combined: {slug}-{timestamp} (max 50 chars total)
  - Example: add-auth-jwt-20250123145030

  Breaking change (v3.0): Format reversed from {timestamp}-{slug} to {slug}-{timestamp}.
  This prioritizes semantic information for better discoverability and IDE autocomplete support.

  Key principle: Specs capture WHAT needs to be built, not HOW to build it.
  Implementation details belong in the plan.yaml, not spec.yaml.

  The command emphasizes active use of open_questions section to capture
  ambiguities rather than making assumptions. Agents should present open
  questions to users before proceeding to /plan.

  Clarifying Question Format (v4.0):
  - Questions numbered sequentially: 1, 2, 3, 4...
  - Provide 2-3 predefined options per question: A, B, C
  - Always include final option: X. Other (please specify)
  - Use structured format when predefined options make sense
  - Fall back to plain text questions when options would be artificial
  - Format is documented in spec.md Step 4 (lines 110-159)

  Example question format:
  **1. What should be the JWT token expiration time?**
     A. 15 minutes
     B. 30 minutes
     C. 1 hour
     X. Other (please specify)

  Users can respond with: "1. A; 2. B" or "1. X: custom value; 2. C"
