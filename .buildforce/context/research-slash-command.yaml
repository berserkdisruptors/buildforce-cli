id: research-slash-command
name: "RESEARCH Slash Command"
type: feature
status: production
created: "2025-01-15"
last_updated: "2025-10-28"

summary: |
  First command in the spec-driven development workflow.
  Gathers context and prepares the context window by searching project knowledge repository,
  exploring codebase, fetching current web information, or leveraging general knowledge.

responsibilities:
  - Search .buildforce/context/_index.yaml for accumulated project knowledge
  - Determine appropriate research strategy based on query analysis
  - Produce structured reports with file paths, diagrams, and data models
  - Guide users toward next workflow step (/spec)

dependencies:
  internal:
    - context-repository: "Primary knowledge source via _index.yaml"
    - slash-commands: "Part of 5-command workflow system"
    - cli-architecture: "Command template distributed via CLI project initialization"
    - research-persistence: "Appends complete output to .research-cache.md for materialization"
  external:
    - None (instruction template for Claude Code)

files:
  primary:
    - src/templates/commands/research.md
  secondary:
    - .buildforce/context/_index.yaml (searched first)
    - .claude/commands/research.md (deployed template)

command_signature:
  syntax: "/research <query>"
  arguments:
    - name: "query"
      type: "string"
      required: true
      description: "Natural language query describing what context is needed"
  examples:
    - "/research current best practices for OAuth 2.0 grant flow with Cognito"
    - "/research how is email sending implemented in this codebase"
    - "/research what patterns do we use for error handling"

key_guidelines:
  - name: "Project Context Search"
    priority: 1
    description: "ALWAYS start by searching .buildforce/context/_index.yaml for relevant accumulated knowledge from past spec-driven sessions"

  - name: "Recency Awareness"
    priority: 2
    description: "Detect keywords like 'current', 'latest', 'recent', 'modern', 'best practices', '2024', '2025', 'up-to-date' and use web search for current information"

  - name: "Structured Output"
    priority: 3
    description: "Present findings as report with sections: Research Summary, Project Context, Codebase Findings, External Knowledge, TLDR, Next Steps"

  - name: "Relevant File Paths"
    priority: 4
    description: "Provide explicit table/list of all relevant file paths to save manual @ references in follow-up commands"

  - name: "Architecture Visualization"
    priority: 5
    description: "Include Mermaid diagrams showing architecture, flow, or relationships for codebase queries"

  - name: "Data Models"
    priority: 6
    description: "Document data structures with properties, types, and relationships—not just summaries"

  - name: "Next Steps"
    priority: 7
    description: "Suggest next action after research (e.g., 'Ready to define the spec?')"

  - name: "TLDR Section"
    priority: 8
    description: "ALWAYS add '## TLDR' section before 'Next Steps' with 3-7 bullet points (using '-') highlighting key discoveries. Exclude code/diagrams/file paths. Include section references and focus on what user needs to know to proceed."

research_strategies:
  project_context:
    trigger: "Always first step"
    action: "Search _index.yaml → Read matching context files"
    output: "Accumulated project knowledge"

  codebase_exploration:
    trigger: "Phrases like 'we have', 'our implementation', 'in this project', 'how is X implemented here'"
    action: "Use Grep, Glob, Read to find implementations and patterns"
    output: "File paths, code snippets, architecture diagrams"

  web_search:
    trigger: "Recency indicators detected"
    action: "Fetch current information from authoritative sources"
    output: "Links, best practices, recent documentation"

  general_knowledge:
    trigger: "Conceptual questions without recency/codebase signals"
    action: "Use training data or supplement with web search if uncertain"
    output: "Explanations, patterns, theory"

output_structure:
  sections:
    - name: "Research Summary"
      content: "High-level overview of findings"

    - name: "Project Context"
      content: "Relevant accumulated knowledge from .buildforce/context"
      conditional: "If context files found"

    - name: "Codebase Findings"
      content: "File paths (table/list), code patterns, architecture diagram (Mermaid), data models"
      conditional: "If codebase exploration performed"

    - name: "External Knowledge"
      content: "Links, best practices, recent information"
      conditional: "If web search performed"

    - name: "TLDR"
      content: "3-7 concise bullet points summarizing key findings for quick user scanning. Excludes code/diagrams. Includes section references."
      conditional: "Always present (added in v1.1)"

    - name: "Next Steps"
      content: "Suggested action (e.g., /spec, further exploration)"

design_decisions:
  - decision: "Context repository as primary source"
    rationale: "Leverages accumulated project knowledge to avoid redundant codebase exploration"

  - decision: "Automatic recency detection"
    rationale: "Prevents hallucination and outdated information for current topics"

  - decision: "Explicit file path lists"
    rationale: "Saves time—users don't need to manually @ files in subsequent commands"

  - decision: "Mermaid diagrams for architecture"
    rationale: "Visual representation helps understand complex relationships quickly"

  - decision: "Concrete data model documentation"
    rationale: "Ensures /spec and /plan have precise type information, not vague summaries"

  - decision: "TLDR section for dual-audience output"
    rationale: "Balances comprehensive context for build agents with quick scannable summary for users. Positioned before 'Next Steps' at natural decision point in workflow."

evolution:
  - version: "1.0"
    date: "2025-01-15"
    changes: "Initial implementation with 7 key guidelines and project context search"

  - version: "1.1"
    date: "2025-10-24"
    changes: "Added TLDR section (guideline #8) for dual-audience output. Template increased from 28 to 29 lines. TLDR provides 3-7 bullet points with consistent formatting (## TLDR heading, - bullets) for quick user scanning while preserving comprehensive details for build agents."

  - version: "2.0"
    date: "2025-10-28"
    changes: "Added research persistence section. Command now appends COMPLETE output to .research-cache.md with session metadata (timestamp, type=research_command) for intelligent materialization by /spec command. Template increased from 29 to 65 lines. Includes cache format specification and state checking (.current-spec) to determine if cache should accumulate."

related_specs:
  - add-research-tldr-section-20251024104500
  - research-persistence-intelligent-20251027213207

notes: |
  Most important command in the workflow—sets foundation for /spec, /plan, /build.
  Compact instruction template (29 lines as of v1.1) that enhances user queries without teaching HOW to research.
  Build agents already know how to research; this command adds workflow-specific context.
  Masterpiece feature: .buildforce/context/_index.yaml as primary knowledge source.

  v1.1 enhancement: TLDR section addresses dual-audience design pattern—comprehensive details for build agents,
  scannable summary for users. Could be applied to other verbose command outputs.
