id: plan-template
name: "Enhanced Plan Template for Build Agent Execution"
type: feature
status: production
created: 2025-10-09
last_updated: 2025-10-09

summary: |
  Enhanced plan-template.yaml optimized for AI build agent execution during /build commands.
  Introduces checkbox-based progress tracking, deviation logging, spec requirement traceability,
  per-phase validation checklists, and comprehensive implementation guidance. This template
  replaces status-based tracking with intuitive markdown checkboxes and adds structural
  improvements to support transparent, iterative development workflows.

responsibilities:
  - Provide structured template for implementation planning via /plan command
  - Enable checkbox-based task progress tracking ([ ] / [x] format)
  - Support deviation logging for transparency during /build execution
  - Enable spec requirement traceability via spec_refs field
  - Provide per-phase validation checkpoints
  - Track spec coverage mapping requirements to implementation tasks
  - Guide testing strategy with automated and manual test sections
  - Support iterative refinement across multiple /build sessions

dependencies:
  internal:
    - /plan command: "Generates plan.yml from this template"
    - /build command: "Consumes plan.yml for implementation execution"
    - spec-template.yaml: "Source of spec requirement IDs (FR*, NFR*, AC*)"
  external: {}

files:
  primary:
    - src/templates/plan-template.yaml
  secondary:
    - .buildforce/specs/20250103120000-plan-template/spec.yml
    - .buildforce/specs/20250103120000-plan-template/plan.yml

design_decisions:
  - decision: "Use markdown checkbox syntax [ ] / [x] instead of status fields"
    rationale: "Checkbox syntax is more intuitive for task completion tracking, widely recognized in markdown-based systems, and easier for AI agents to parse and update than custom status strings."

  - decision: "Central deviation log section instead of per-task deviation fields"
    rationale: "Central log provides chronological view of all deviations across phases, making it easier to review implementation changes holistically. Prevents duplication and maintains clear audit trail."

  - decision: "Keep flat task lists instead of nested hierarchies"
    rationale: "Simpler for agent parsing and execution. Complex tasks can be broken down into multiple flat tasks rather than nesting, reducing cognitive load during implementation."

  - decision: "Add spec_refs as arrays to support many-to-many relationships"
    rationale: "A single task may satisfy multiple spec requirements, and a single requirement may span multiple tasks. Array format provides maximum flexibility for traceability."

  - decision: "Remove timestamps, assignees, and session logs from template"
    rationale: "These fields are not relevant for single-session AI agent execution. Removing them reduces template complexity and focuses on what matters for agent-driven development."

interfaces:
  template_structure:
    - section: "Header"
      fields: "id, name, spec_id, type, status, created, last_updated"

    - section: "Architecture Overview"
      fields: "approach, technology_stack, decisions"

    - section: "File Structure"
      fields: "files_to_create, files_to_modify"

    - section: "Implementation Phases"
      fields: "phase_N (name, description, tasks with checkboxes, validation checklist)"

    - section: "Deviation Log"
      fields: "phase, task, original, actual, reason"

    - section: "Testing Guidance"
      fields: "automated_tests (test_file, what, command), manual_tests (scenario, steps)"

    - section: "Validation Criteria"
      fields: "success_metrics, spec_coverage"

    - section: "Progress Summary"
      fields: "overall_progress, current_status, next_immediate_steps"

    - section: "Risks & Considerations"
      fields: "risks (risk, mitigation)"

    - section: "Notes"
      fields: "lessons_learned, future_enhancements"

  task_structure:
    - field: "checkbox"
      format: "- [ ] or - [x]"
      description: "Task completion status"

    - field: "spec_refs"
      format: "[FR1, FR2, NFR1]"
      description: "Links to spec requirements"

    - field: "files"
      format: "[path/to/file.ts]"
      description: "Files affected by this task"

    - field: "notes"
      format: "string"
      description: "Implementation notes or learnings"

evolution:
  - version: "1.0"
    date: "2025-10-09"
    changes: |
      Initial enhanced template implementation with:
      - Checkbox-based task tracking ([ ] / [x])
      - Deviation logging section
      - Spec requirement traceability (spec_refs)
      - Per-phase validation checklists
      - Per-task file references and notes
      - Spec coverage tracking
      - Restructured testing guidance
      - Comprehensive usage comments

      Replaced old template structure:
      - Removed status-based task tracking
      - Removed implementation steps section (redundant with phases)
      - Removed timestamps and percentage-based progress
      - Removed estimated_completion fields

related_specs:
  - .buildforce/specs/20250103120000-plan-template/spec.yml
  - .buildforce/specs/20250103120000-plan-template/plan.yml

key_features:
  progress_tracking:
    - Checkbox syntax for visual task completion
    - Task count format (e.g., "5/10 tasks completed")
    - Per-phase validation checklists

  traceability:
    - spec_refs field links tasks to spec requirements
    - spec_coverage section maps requirements to implementation
    - Files array shows which files each task affects

  transparency:
    - Deviation log captures all plan changes
    - Implementation notes field per task
    - Current status section tracks overall progress

  testing:
    - Automated tests with file, command, and purpose
    - Manual tests with scenario and step-by-step instructions
    - Success metrics for validation

implementation_highlights:
  - Meta-implementation: The plan.yml for this spec uses the enhanced template it defines
  - All 9 functional requirements (FR1-FR9) implemented
  - All 4 non-functional requirements (NFR1-NFR4) satisfied
  - All 8 acceptance criteria (AC1-AC8) verified
  - Manual testing with /plan and /build commands confirmed compatibility
  - Backward compatible with existing spec files

notes: |
  This enhancement significantly improves the /build agent's ability to track progress
  and maintain transparency during implementation. The checkbox format is intuitive for
  both humans and AI agents, making it easy to see at a glance what's been completed.

  The deviation log is particularly valuable for iterative development, as it maintains
  a clear record of how implementation diverged from the original plan and why. This
  transparency is critical for understanding implementation decisions and for improving
  future planning.

  The spec_refs field creates explicit traceability between requirements and implementation,
  making it easy to verify that all spec requirements have been addressed. The spec_coverage
  section provides a reverse mapping, showing which tasks implement each requirement.

  Future enhancements could include:
  - Automated progress calculation based on checkbox counts
  - Task dependency tracking (depends_on, blocks fields)
  - Priority/ordering fields for task sequencing
  - Estimated effort fields for planning (story points, hours)
  - Template version system for migration support
  - Integration with testing frameworks for automatic validation

  The template is designed to be agent-first but remains fully human-readable, making
  it suitable for both AI-driven and manual workflows.
